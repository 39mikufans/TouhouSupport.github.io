var aidnlib,app,__extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(t,i){function e(){this.constructor=t}n(t,i),t.prototype=null===i?Object.create(i):(e.prototype=i.prototype,new e)}}();!function(t){var r=function(){function t(){}return t.get=function(t){return this._data[t]},t.add=function(t,i){this._data[t]=i},t._data={},t}();t.Assets=r;var o=function(){};t.Ref=o;var i=function(){function t(){this.__keyCount=0,this.__updates={},this.__resizes={}}return t.prototype.initialize=function(){o.stw=aidn.window.width(),o.sth=aidn.window.height(),aidn.util.needExpandArea(!0),aidn.window.addDummyDiv()},t.prototype._start=function(){var t=this;o.time=Date.now()/1e3,aidn.window.resize(function(){return t._resize()},!0),this._resize(),this._update()},t.prototype.addUpdate=function(t,i){t.__key||(t.__key="key_"+this.__keyCount,this.__keyCount++),this.__updates[t.__key]=i},t.prototype.removeUpdate=function(t){t.__key&&delete this.__updates[t.__key]},t.prototype.addResize=function(t,i){t.__key2||(t.__key2="key_"+this.__keyCount,this.__keyCount++),this.__resizes[t.__key2]=i},t.prototype.removeResize=function(t){t.__key2&&delete this.__resizes[t.__key2]},t.prototype._update=function(){var t=Date.now()/1e3;for(var i in o.delta=t-o.time,o.time=t,this.__updates)this.__updates[i]()},t.prototype._resize=function(){for(var t in o.stw=aidn.window.width(),o.sth=aidn.window.height(),this.__resizes)this.__resizes[t]()},t}();t.MainBase=i;var e=function(){function t(){this._ori=0,this._dx=0,this._dy=0,this._rx=0,this._ry=0,this.__updates={},this.__keyCount=0,this._timeoutId=null,this._isAndroid=!1,this._ax=-1e3,this._ay=-1e3}return t.prototype.start=function(){var i=this;aidn.util.checkMobile()?(window.addEventListener("deviceorientation",function(t){return i._deviceorientation(t)}),window.addEventListener("orientationchange",function(t){return i._orientationchange(t)},!1),this._orientationchange(),this._timeoutId=setTimeout(function(){return i._failedDeviceOrientation()},2e3),this._isAndroid=aidn.util.checkAndroid()):($("body").on("mousemove",function(t){return i._mouseMove(t)}),this._update())},t.prototype.addUpdate=function(t,i){t.__keyx||(t.__keyx="keyx_"+this.__keyCount,this.__keyCount++),this.__updates[t.__keyx]=i},t.prototype.removeUpdate=function(t){t.__keyx&&delete this.__updates[t.__keyx]},t.prototype._updateRate=function(t,i){for(var e in this.__updates)this.__updates[e](t,i)},t.prototype._mouseMove=function(t){var i=o.stw/2,e=o.sth/2,n=aidn.event.getPos(t);this._dx=(n.x-i)/i,this._dy=(n.y-e)/e},t.prototype._update=function(){var t=this;this._rx+=(this._dx-this._rx)/5,this._ry+=(this._dy-this._ry)/5,this._updateRate(this._rx,this._ry),window.requestAnimationFrame(function(){return t._update()})},t.prototype._deviceorientation=function(t){var i=t.gamma,e=t.beta;if(null!=this._timeoutId&&(clearTimeout(this._timeoutId),this._timeoutId=null),0!=this._ori){var n=e;e=i,i=n,90==this._ori&&(e=-e),-90==this._ori&&(i=-i)}var o=i/35;o=Math.max(o,-1),o=Math.min(o,1);var s=e/35;s=Math.max(s,-1),s=Math.min(s,1),this._updateRate(o,s)},t.prototype._devicemotion=function(t){var i=t.accelerationIncludingGravity||t.acceleration;this._ax<-100?(this._ax=i.x,this._ay=i.y):(this._ax+=(i.x-this._ax)/3,this._ay+=(i.y-this._ay)/3);var e=Math.floor(10*this._ax)/10,n=-Math.floor(10*this._ay)/10;if(this._isAndroid&&(e=-e,n=-n),0!=this._ori){var o=n;n=e,e=o,90==this._ori&&(n=-n),-90==this._ori&&(e=-e)}var s=e/5;s=Math.max(s,-1),s=Math.min(s,1);var r=n/5;r=Math.max(r,-1),r=Math.min(r,1),this._updateRate(s,r)},t.prototype._orientationchange=function(t){void 0===t&&(t=null),this._ori=parseInt(window.orientation.toString())||0,-1==this._ori&&(this._ori=0)},t.prototype._failedDeviceOrientation=function(){var i=this;window.addEventListener("devicemotion",function(t){return i._devicemotion(t)})},t}();t.DeviceManager=e;var n=function(){function t(){this.listeners={}}return t.prototype.dispatchEvent=function(t){var i,e;if(t instanceof a?(e=t.type,i=t):i=new a(e=t),null!=this.listeners[e])for(var n=(i.currentTarget=this).listeners[e].length,o=0;o<n&&this.listeners[e];o++){var s=this.listeners[e][o];try{s.handler(i)}catch(t){window.console&&console.error(t.stack)}}},t.prototype.addEventListener=function(t,i,e){void 0===e&&(e=0),null==this.listeners[t]&&(this.listeners[t]=[]),this.listeners[t].push(new s(t,i,e)),this.listeners[t].sort(function(t,i){return i.priolity-t.priolity})},t.prototype.removeEventListener=function(t,i){if(this.hasEventListener(t,i))for(var e=0;e<this.listeners[t].length;e++){var n=this.listeners[t][e];if(n.equalCurrentListener(t,i))return n.handler=null,void this.listeners[t].splice(e,1)}},t.prototype.clearEventListener=function(){this.listeners={}},t.prototype.containEventListener=function(t){return null!=this.listeners[t]&&0<this.listeners[t].length},t.prototype.hasEventListener=function(t,i){if(null==this.listeners[t])return!1;for(var e=0;e<this.listeners[t].length;e++){if(this.listeners[t][e].equalCurrentListener(t,i))return!0}return!1},t}();t.EventDispatcher=n;var s=function(){function t(t,i,e){void 0===t&&(t=null),void 0===i&&(i=null),void 0===e&&(e=0),this.type=t,this.handler=i,this.priolity=e}return t.prototype.equalCurrentListener=function(t,i){return this.type==t&&this.handler==i},t}(),a=function(t,i){void 0===t&&(t=null),void 0===i&&(i=null),this.type=t,this.data=i};t.Event=a;var c=function(i){function t(){var t=i.call(this)||this;return t._loaded=!1,t}return __extends(t,i),t.prototype.execute=function(){},t.prototype.cancel=function(){},t.prototype._dispatchComplete=function(){this._loaded=!0,this.dispatchEvent(new h(h.COMPLETE))},t.prototype._dispatchFailed=function(){this.dispatchEvent(new h(h.FAILED))},t.prototype._dispatchProgress=function(t){var i=new h(h.PROGRESS);i.progress=t,this.dispatchEvent(i)},t}(n);t.CommandBase=c;var h=function(i){function t(t){return i.call(this,t)||this}return __extends(t,i),t.COMPLETE="complete",t.FAILED="failed",t.PROGRESS="progress",t}(a);t.CommandEvent=h;var u=function(e){function t(t){void 0===t&&(t=1);var i=e.call(this)||this;return i._rates=[],i._sum=0,i._commands=[],i._now=0,i._total=0,i._compnum=0,i._compflags=[],i._connectionNum=t,i}return __extends(t,e),t.prototype.execute=function(){if(this._loaded=!1,this._now=this._compnum=this._compRate=0,this._compflags=[],this._progRates=[],this._total<=this._compnum)return this._dispatchProgress(1),void this._dispatchComplete();for(var t=Math.min(this._total,this._connectionNum),i=0;i<t;i++)this._execute()},t.prototype.cancel=function(){if(!(this._total<=this._compnum))for(var t=0;t<this._total;t++)try{var i=this._commands[t];this._removeEvents(i),i.cancel()}catch(t){}},t.prototype.add=function(t,i){void 0===i&&(i=1),this._commands[this._total]=t,this._rates[this._total]=i,this._sum+=i,this._total++},t.prototype._execute=function(){var i=this;if(this._now<this._total){this._rates[this._now]=this._rates[this._now]/this._sum,this._progRates[this._now]=0;var t=this._commands[this._now];t.__id=this._now,t.addEventListener(h.COMPLETE,function(t){return i._complete(t)}),t.addEventListener(h.PROGRESS,function(t){return i._progress(t)}),t.addEventListener(h.FAILED,function(t){return i._failed(t)}),t.execute(),this._now++}else this._total<=this._compnum&&(this._dispatchProgress(1),this._dispatchComplete())},t.prototype._removeEvents=function(t){t.clearEventListener()},t.prototype._completeCommand=function(t,i){},t.prototype._complete=function(t){var i=t.currentTarget.__id,e=this._commands[i];this._removeEvents(e),this._compRate+=this._rates[i],this._compflags[i]=!0,this.__progress(),this._completeCommand(e,i),this._compnum++,this._execute()},t.prototype._progress=function(t){var i=t.currentTarget.__id;this._progRates[i]=t.progress*this._rates[i],this.__progress()},t.prototype.__progress=function(){for(var t=0,i=0;i<this._now;i++)this._compflags[i]||(t+=this._progRates[i]);this._dispatchProgress(this._compRate+t)},t.prototype._failed=function(t){var i=t.currentTarget.__id,e=this._commands[i];this._removeEvents(e),this._dispatchFailed()},Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!0,configurable:!0}),t}(c);t.SequentialCommand=u;var _=function(s){function t(t,i,e,n){void 0===i&&(i=null),void 0===e&&(e=!1),void 0===n&&(n=-1);var o=s.call(this)||this;return o._id=i,o._url=t,o._isplay=e,o._trimvol=n,o}return __extends(t,s),t.prototype.execute=function(){var i=this,t=function(){i._complete()},e=function(t){i._progress(t)};this._audio=new aidn.AutoAudio(null),this._isplay?(this._audio.load([this._url],null,this._trimvol,e),this._audio.play(0,!1,t,0,0)):this._audio.load([this._url],t,this._trimvol,e)},t.prototype._progress=function(t){this._dispatchProgress(t)},t.prototype._complete=function(){this._isplay&&this._audio.stop();var t=this._id;t||(t=this._url),r.add(t,this._audio),this._dispatchComplete()},t}(c);t.AudioLoadCommand=_;var d=function(o){function t(t,i,e){void 0===i&&(i=null),void 0===e&&(e=-1);var n=o.call(this)||this;return n._url=t,n._type=e,(n._name=i)||(n._name=t),n}return __extends(t,o),t.prototype.execute=function(){var t,i=this,e=new Image,n=this._name;t=this._type==f.PIXI?function(){var t=new PIXI.Texture(new PIXI.BaseTexture(e));PIXI.Texture.addTextureToCache(t,n),r.add(n,t),setTimeout(function(){i._complete()},10)}:this._type==f.THREE?function(){var t=new THREE.Texture(e);t.needsUpdate=!0,r.add(n,t),setTimeout(function(){i._complete()},10)}:function(){r.add(n,e),setTimeout(function(){i._complete()},10)},e.onload=t,e.src=this._url},t.prototype._complete=function(){this._dispatchComplete()},t}(c);t.ImageLoadCommand=d;var l=function(r){function t(t,i,e){void 0===i&&(i=1),void 0===e&&(e=0);for(var n=r.call(this,i)||this,o=t.length,s=0;s<o;s++)n.add(new p(t[s],e));return n}return __extends(t,r),t}(u);t.ScriptsLoaderCommand=l;var p=function(n){function t(t,i){void 0===i&&(i=0);var e=n.call(this)||this;return e._url=t,e._ver=i,e}return __extends(t,n),t.prototype.execute=function(){var t=this;$.ajax({url:this._url+"?"+this._ver,cache:!0,dataType:"script"}).then(function(){return t._complete()},function(){return t._failed()})},t.prototype._complete=function(){this._dispatchComplete()},t.prototype._failed=function(){this._dispatchFailed()},t}(c),f=function(){function t(){}return t.PIXI=0,t.THREE=1,t.IMG=2,t}();t.JsonBase64Type=f;var v=function(o){function t(t,i,e){void 0===i&&(i=0),void 0===e&&(e=.3);var n=o.call(this)||this;return n._keys=[],n._context=null,n._url=t,n._type=i,n._jsonRate=e,n}return __extends(t,o),t.prototype.execute=function(){var i=this,t={method:"GET",url:this._url,dataType:"json",success:function(t){i._complete(t)},xhr:function(){var t=$.ajaxSettings.xhr();return t.onprogress=function(t){i._dispatchProgress(i._jsonRate*(t.loaded/t.total))},t}};$.ajax(t)},t.prototype._setupAudio=function(t){this._context=t},t.prototype._complete=function(t){this._data=t;var i=0;for(var e in t)this._keys[i++]=e;this._now=-1,this._len=i,this._next()},t.prototype._next=function(){if(this._now++,this._now<this._len){this._dispatchProgress(this._jsonRate+(1-this._jsonRate)*(this._now/this._len));var i=this,e=this._keys[this._now],t=this._data[e];if(0<e.lastIndexOf(".mp3")||0<e.lastIndexOf(".ogg"))if(aidn.util.webaudio){this._context&&(aidn.___waContext=this._context);var n=new aidn.WebAudio;r.add(e,n),n.load(t,function(){i._next()})}else setTimeout(function(){i._next()},10);else{var o,s=new Image;o=this._type==f.PIXI?function(){var t=new PIXI.Texture(new PIXI.BaseTexture(s));PIXI.Texture.addToCache?PIXI.Texture.addToCache(t,e):PIXI.Texture.addTextureToCache(t,e),r.add(e,t),setTimeout(function(){i._next()},10)}:this._type==f.THREE?function(){var t=new THREE.Texture(s);t.needsUpdate=!0,r.add(e,t),setTimeout(function(){i._next()},10)}:function(){r.add(e,s),setTimeout(function(){i._next()},10)},s.onload=o,s.src=t}}else this._dispatchComplete()},t}(c);t.JsonBase64LoadCommand=v;var m=function(){function t(t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i}return t.prototype.set=function(t,i){return void 0===t&&(t=0),void 0===i&&(i=0),this.x=t,this.y=i,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.distance=function(t){var i=this.x-t.x,e=this.y-t.y;return Math.sqrt(i*i+e*e)},t}();t.Point=m;var y=function(){function t(){}return t.random=function(t){void 0===t&&(t=null);var i=this.seed;return null!=t&&(i=t),i^=i<<13,i^=i>>17,i^=i<<15,(this.seed=i)/4294967296+.5},t.randInt=function(t,i,e){return void 0===e&&(e=null),Math.floor(this.rand(t,i+1,e))},t.rand=function(t,i,e){return void 0===e&&(e=null),this.random(e)*(i-t)+t},t.arrayShuffle=function(t){for(var i=t.length,e=0;e<i;e++){var n=this.randInt(0,i-1),o=t[e];t[e]=t[n],t[n]=o}},t.seed=0,t}();t.Util=y}(aidnlib||(aidnlib={})),function(v){var i=aidnlib.Ref,t=function(){function t(){var t=this;this._audioData=[],this._isPlaying=!1,this._oscillators=[],this._tid=-1,this._channelNum=2,this._volumeRate=1,this._bufferSize=2048,this._t=0,this._initCanvas(),v.Context.main.addResize(this,function(){return t._resize()})}return t.prototype.userAction=function(){var i=this;this._ctx||(window.AudioContext=window.AudioContext||window.webkitAudioContext,this._ctx=new AudioContext,this._ctx.createScriptProcessor=this._ctx.createScriptProcessor||this._ctx.createJavaScriptNode,this._ctx.createPeriodicWave=this._ctx.createPeriodicWave||this._ctx.createWaveTable,this._processor=this._ctx.createScriptProcessor(this._bufferSize,2,2),this._analyzer=this._ctx.createAnalyser(),this._processor.connect(this._analyzer),this._analyzer.connect(this._ctx.destination),this._compressor=this._ctx.createDynamicsCompressor(),this._compressor.threshold.setValueAtTime(-30,this._ctx.currentTime),this._compressor.knee.setValueAtTime(30,this._ctx.currentTime),this._compressor.ratio.setValueAtTime(4,this._ctx.currentTime),this._compressor.attack.setValueAtTime(0,this._ctx.currentTime),this._compressor.release.setValueAtTime(.05,this._ctx.currentTime),this._compressor.connect(this._processor),this._analyzer.fftSize=512,this._analyBufferLength=this._analyzer.frequencyBinCount,this._analyDataArray=new Uint8Array(this._analyBufferLength),this._processor.addEventListener("audioprocess",function(t){return i._audioProcess(t)}),v.Context.main.addUpdate(this,function(){return i._draw()}))},t.prototype._initCanvas=function(){this._canvas=document.getElementById("canvas"),this._context=this._canvas.getContext("2d")},t.prototype._resize=function(){var t=this._canvas;t.width=i.stw,t.height=Math.min(i.sth,420)},t.prototype._draw=function(){var t=this._canvas.width,i=this._canvas.height,e=this._context;if(e.clearRect(0,0,t,i),this._isPlaying&&!(this._volumeRate<=0)){this._analyzer.getByteTimeDomainData(this._analyDataArray),e.lineWidth=1.3,e.strokeStyle="rgb(55, 55, 60)",e.beginPath();for(var n=t/this._analyBufferLength,o=0,s=0;s<this._analyBufferLength;s++){var r=this._analyDataArray[s]/255*i;0===s?e.moveTo(o,r):e.lineTo(o,r),o+=n}e.lineTo(t,i/2),e.stroke()}},t.prototype._audioProcess=function(t){if(this._isPlaying){for(var i=this._bufferSize,e=new Float32Array(i*this._channelNum),n=t.inputBuffer.getChannelData(0),o=t.inputBuffer.getChannelData(1),s=t.outputBuffer.getChannelData(0),r=t.outputBuffer.getChannelData(1),a=0;a<i;a++)s[a]=1*n[a]*this._volumeRate,r[a]=1*o[a]*this._volumeRate,1==this._channelNum?e[a]=1*n[a]:(e[2*a]=1*n[a],e[2*a+1]=1*o[a]);this._audioData.push(e)}},t.prototype.play=function(t,i){var e=this;void 0===i&&(i=1),this._volumeRate=i,v.UtilBig.setSeed(t.id),this._audioData=[],this._isPlaying=!0,clearTimeout(this._tid);for(var n=.2,o=0;o<this._oscillators.length;o++)this._oscillators[o]&&this._oscillators[o].stop();var s=v.UtilBig.randomN(),r=1;s<.2?r=2:s<.3?r=3:s<.52?r=6:s<.64&&(r=8);var a=r,c=this._compressor,h=1;v.UtilBig.randomN()<.35&&(h=0);var u=5<=r||2<=r&&v.UtilBig.randomN()<.4;for(o=0;o<r;o++){var _=this._oscillators[o];if(_||(_=this._oscillators[o]=new l(this._ctx)),u)0==o?n=Math.max(n,_.start(c,a)):_.startCopy(c,this._oscillators[0],h+o*v.UtilBig.randN(1.05,1.7),n);else{var d=-1;0<o&&(d=n),n=v.UtilBig.randomN()<.22?Math.max(n,_.startNoise(c,a,d)):Math.max(n,_.start(c,a,d))}}this._tid=setTimeout(function(){return e._stop()},1e3*(n+.3)),$("#canvas").stop().show().fadeIn(0).delay(1e3*(n+.1)).fadeOut(200,"linear")},t.prototype._stop=function(){this._isPlaying=!1,this._exportWav(this._audioData);for(var t=0;t<this._oscillators.length;t++)this._oscillators[t]&&this._oscillators[t].stop()},t.prototype._encodeWav=function(t,i){var e=this._channelNum,n=new ArrayBuffer(44+2*t.length),o=new DataView(n),s=function(t,i,e){for(var n=0;n<e.length;n++)t.setUint8(i+n,e.charCodeAt(n))};return s(o,0,"RIFF"),o.setUint32(4,32+2*t.length,!0),s(o,8,"WAVE"),s(o,12,"fmt "),o.setUint32(16,16,!0),o.setUint16(20,1,!0),o.setUint16(22,e,!0),o.setUint32(24,i,!0),o.setUint32(28,2*i*e,!0),o.setUint16(32,2*e,!0),o.setUint16(34,16,!0),s(o,36,"data"),o.setUint32(40,2*t.length,!0),function(t,i,e){for(var n=0;n<e.length;n++,i+=2){var o=Math.max(-1,Math.min(1,e[n]));t.setInt16(i,o<0?32768*o:32767*o,!0)}}(o,44,t),o},t.prototype._exportWav=function(t){var i=this._encodeWav(function(t){for(var i=0,e=0;e<t.length;e++)i+=t[e].length;var n=new Float32Array(i),o=0;for(e=0;e<t.length;e++)for(var s=0;s<t[e].length;s++)n[o]=t[e][s],o++;return n}(t),this._ctx.sampleRate),e=new Blob([i],{type:"audio/wav"}),n=(window.URL||window.webkitURL).createObjectURL(e);$("#audio").attr("src",n),$("#bt_download").attr("href",n);var o="se.wav";return v.Context.data&&(o="se_"+v.Context.data.getHash()+".wav"),$("#bt_download").attr("download",o),n},t}();v.SoundManager=t;var l=function(){function f(t){this._ctx=t}return f.prototype.start=function(t,i,e){void 0===i&&(i=1),void 0===e&&(e=-1);var n,o=this._ctx,s=o.currentTime,r=this._osc=o.createOscillator(),a=this._gain=o.createGain();if(r.connect(a),a.connect(t),e<=0){var c=v.UtilBig.randomN();e=v.UtilBig.randN(.2,.6),c<.2&&(e=v.UtilBig.randN(.7,1.4))}return n=1-(this._setupOsc(r,e)-300)/700*.4,n=Math.max(Math.min(n,1),.6),n/=i,this._setupGain(a,e,n),r.start(s),r.stop(s+e),e},f.prototype.stop=function(){try{this._osc&&this._osc.frequency.cancelScheduledValues(0),this._gain&&this._gain.gain.cancelScheduledValues(0)}catch(t){}try{this._osc&&this._osc.disconnect(),this._gain&&this._gain.disconnect(),this._buffer&&this._buffer.disconnect()}catch(t){}this._osc=null,this._gain=null,this._buffer=null},f.prototype._getBuffer=function(t,i){void 0===t&&(t=1),void 0===i&&(i=0);var e=this._ctx.sampleRate,n=this._ctx.createBuffer(1,Math.floor(e*t*.99),this._ctx.sampleRate),o=n.getChannelData(0);switch(i){case 0:for(var s=0;s<e;s++)o[s]=2*Math.random()-1;break;case 1:var r,a,c,h,u,_,d;r=a=c=h=u=_=d=0;for(s=0;s<e;s++){r=.99886*r+.0555179*(p=2*Math.random()-1),a=.99332*a+.0750759*p,c=.969*c+.153852*p,h=.8665*h+.3104856*p,u=.55*u+.5329522*p,_=-.7616*_-.016898*p,o[s]=r+a+c+h+u+_+d+.5362*p,o[s]*=.11,d=.115926*p}break;default:var l=0;for(s=0;s<e;s++){var p=2*Math.random()-1;o[s]=(l+.02*p)/1.02,l=o[s],o[s]*=3.5}}return n},f.prototype.startNoise=function(t,i,e){void 0===i&&(i=1),void 0===e&&(e=-1);var n=this._ctx,o=n.currentTime,s=this._buffer=n.createBufferSource(),r=this._gain=n.createGain();if(s.connect(r),r.connect(t),e<=0){var a=v.UtilBig.randomN();e=v.UtilBig.randN(.2,.6),a<.2&&(e=v.UtilBig.randN(.7,1.4))}var c=0;(a=v.UtilBig.randomN())<.3?c=1:a<.5&&(c=2),s.buffer=this._getBuffer(e,c);var h=1/i;return this._setupGain(r,e,h),s.start(o),s.stop(o+e),e},f.prototype.startCopy=function(t,i,e,n){void 0===e&&(e=1),void 0===n&&(n=-1);var o=i.getParamOsc(),s=i.getParamGain(),r=this._ctx,a=r.currentTime,c=this._osc=r.createOscillator(),h=this._gain=r.createGain();if(c.connect(h),h.connect(t),n<=0){var u=v.UtilBig.randomN();n=v.UtilBig.randN(.2,.6),u<.2&&(n=v.UtilBig.randN(.7,1.4))}for(var _=0,d=o.vals.length;_<d;_++)o.vals[_]=Math.min(o.vals[_]*e,22050);return this._envelope(c.frequency,o),this._envelope(h.gain,s),c.start(a),c.stop(a+n),n},f.prototype.getParamOsc=function(){return this._getParam(this._paramOsc)},f.prototype.getParamGain=function(){return this._getParam(this._paramGain)},f.prototype._getParam=function(t){return{times:t.times.concat(),vals:t.vals.concat(),amplitude:t.amplitude,period:t.period}},f.prototype._setupOsc=function(t,i){var e=v.UtilBig.randNInt(0,5);e<=3?t.type=f.TYPES[e]:this._setCustomWave();var n=v.UtilBig.randomN(),o=1800,s=45;n<.28?o=250:n<.37&&(s=1e3,o=3e3);var r=v.UtilBig.randNInt(s,o),a=[0,i],c=[r,r];if((n=v.UtilBig.randomN())<.3)c[1]=v.UtilBig.randNInt(s,o),v.UtilBig.randomN()<.5&&c.reverse();else if(n<.6){var h=v.UtilBig.randNInt(4,10);v.UtilBig.randomN()<.25&&(h*=4);for(var u=0;u<=h;u++)c[u]=v.UtilBig.randNInt(s,o),a[u]=u/h*i}var _=0;for(u=0,h=c.length;u<h;u++)_+=c[u];var d=Math.round(_/h),l=0,p=.1;return(n=v.UtilBig.randomN())<.5&&(l=v.UtilBig.randN(.3,1),p=v.UtilBig.randN(.01,.4)),this._paramOsc={times:a,vals:c,amplitude:l,period:p},this._envelope(t.frequency,this._paramOsc),t.detune.value=0,d},f.prototype._setupGain=function(t,i,e){var n=v.UtilBig.randomN(),o=[0,i],s=[e,e];if(n<.38){for(var r=0,a=v.UtilBig.randNInt(2,6);r<=a;r++)s[r]=Math.pow(r/a,3)*e,o[r]=r/a*i;v.UtilBig.randomN()<.7&&s.reverse()}else if(n<.67){var c=i/2,h=c*v.UtilBig.randN(.4,1);o=[0,h,h+(i-(h+c*v.UtilBig.randN(.4,1))),i],s=[0,e,e,0]}var u=0,_=.1;(n=v.UtilBig.randomN())<.2&&(u=v.UtilBig.randN(.6,1),_=v.UtilBig.randN(.02,.2)),this._paramGain={times:o,vals:s,amplitude:u,period:_},this._envelope(t.gain,this._paramGain)},f.prototype._envelope=function(t,i){var e=this._ctx.currentTime,n=i.times,o=i.vals,s=0,r=.1;isNaN(i.amplitude)||(s=i.amplitude),isNaN(i.period)||(r=i.period);var a=Math.min(.02,r/8);a<=0&&(a=.02);var c=1,h=n[n.length-1];t.setValueAtTime(o[0],e);for(var u=0;u<=h;u+=a){n[c]<u&&c++;var _=o[c-1],d=o[c],l=n[c]-n[c-1],p=_+(0<l?(u-n[c-1])/l:1)*(d-_);0<s&&0<r&&(p+=p*(Math.sin(2*Math.PI*(u/r))-1)*.5*s),t.linearRampToValueAtTime(p,e+u)}},f.prototype._setCustomWave=function(){for(var t=v.UtilBig.randNInt(8,24),i=new Float32Array(t),e=new Float32Array(t),n=0;n<t;n++)i[n]=e[n]=0,0<n&&(e[n]=v.UtilBig.randN(0,1));var o=this._ctx.createPeriodicWave(i,e);this._osc.setPeriodicWave(o)},f.TYPES=["sine","square","sawtooth","triangle"],f}()}(app||(app={})),function(l){var i=aidnlib.Ref,t=aidnlib.MainBase,e=aidnlib.SequentialCommand,p=aidnlib.CommandEvent;l.rand=function(t,i){return t},l.randInt=function(t,i){return t},l.toRad=function(t){return 0},l.toDeg=function(t){return 0};var n=function(){function t(){}return t.prototype.init=function(t){if(void 0===t&&(t=null),t=t.split("#").join(""),this.id=c.randIntMax(),this.version=m.VERSION,!t||""==t)return!1;t.indexOf("+")<0&&(t="1+"+t);var i=t.split("+"),e=parseInt(i.shift());if(isNaN(e))return!1;var n=new BigNumber(i,36);return!(n.isNaN()||m.SIZE*m.SIZE<n.toString(2).length)&&(this.id=n,this.version=e,!0)},t.prototype._get2base=function(){for(var t=this.id.toString(2),i=m.SIZE*m.SIZE-t.length,e=0;e<i;e++)t="0"+t;return t},t.prototype.change2base=function(t){if(!(m.SIZE*m.SIZE<=t)){var i=this._get2base(),e=i.split("");"1"==e[t]?e[t]="0":e[t]="1",i=e.join(""),this.id=new BigNumber(i,2),this.version=m.VERSION}},t.prototype.getHash=function(){var t=this.id.toString(36);return 1<this.version&&(t=this.version+"+"+t),t},t.prototype.getOnOffList=function(){for(var t=this._get2base(),i=[],e=m.SIZE*m.SIZE,n=0;n<e;n++)i[n]=parseInt(t.charAt(n));return i},t}();l.Data=n;var f=function(){function t(){}return t.sceneId=-1,t.floatingId=-1,t.isMobile=!1,t.isJa=!0,t.isFull=!1,t.data=new n,t.sensitivity=.5,t.isFix=!1,t}();l.Context=f;var u,o,v,s,m=function(){function t(){}return t.VERSION=1,t.SIZE=8,t.URL="https://aidn.jp/se/",t}(),y=function(t){function i(){return t.call(this)||this}return __extends(i,t),i}(e),r=function(){function t(){var i=this;this._isDown=!1,this._bx=0,this._bw=100,$("#bar_base").on("mousedown touchstart",function(t){return i._barDown(t)}),$(window).on("mousemove touchmove",function(t){return i._barMove(t)}),$(window).on("mouseup touchend",function(t){return i._barUp(t)}),f.main.addResize(this,function(){return i._resize()}),this._resize(),f.sensitivity=g.sensitivity,this._barUpdate(f.sensitivity)}return t.prototype._resize=function(){this._bx=$("#bar_base").offset().left+3,this._bw=parseInt($("#bar_base").css("width"))},t.prototype._barDown=function(t){this._resize(),t.preventDefault();var i=aidn.event.getPos(t);this._barUpdateX(i.x),this._isDown=!0},t.prototype._barMove=function(t){if(this._isDown){t.preventDefault();var i=aidn.event.getPos(t);this._barUpdateX(i.x)}},t.prototype._barUp=function(t){this._isDown&&(this._isDown=!1,g.sensitivity=f.sensitivity)},t.prototype._barUpdateX=function(t){var i=(t-this._bx)/this._bw;this._barUpdate(i)},t.prototype._barUpdate=function(t){t<0&&(t=0),1<t&&(t=1),f.sensitivity=t,$("#bar").css("width",100*t+"%")},t}(),g=function(){function t(){}return t.init=function(){var t=aidn.util.getStorage("se");t||(t={sense:.5,list:[],first:1}),this._obj=t,aidn.util.setStorage(this._obj,"se")},Object.defineProperty(t,"first",{get:function(){return this._obj.first},set:function(t){this._obj.first=t,aidn.util.setStorage(this._obj,"se")},enumerable:!0,configurable:!0}),Object.defineProperty(t,"sensitivity",{get:function(){return this._obj.sense},set:function(t){this._obj.sense=t,aidn.util.setStorage(this._obj,"se")},enumerable:!0,configurable:!0}),t.getList=function(){return this._obj.list},t.addList=function(t){return!this.checkList(t)&&(this._obj.list.push(t),aidn.util.setStorage(this._obj,"se"),!0)},t.deleteList=function(t){for(var i=this._obj.list.length,e=0;e<i;e++)if(this._obj.list[e]==t)return this._obj.list.splice(e,1),aidn.util.setStorage(this._obj,"se"),!0;return!1},t.checkList=function(t){for(var i=this._obj.list.length,e=0;e<i;e++)if(this._obj.list[e]==t)return!0;return!1},t}(),w=function(){function t(t,i){var e=this;this._emTds=[],this._id=t,this._callback=i;var n="<tr>";n+='<td data-id="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><use xlink:href="#sb_wav"></use></svg></td>',n+='<td data-id="1"><a href="#">'+t+"</a></td>",n+='<td data-id="2"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><use xlink:href="#sb_del"></use></svg></td>',n+="</tr>";var o=$(n);$("#list_table").append(o);for(var s=(this._em=o).children("td"),r=0;r<3;r++)this._emTds[r]=$(s[r]),this._emTds[r].on("click",function(t){return e._click(t)})}return t.prototype.remove=function(){for(var t=0;t<3;t++)this._emTds[t].off("click");this._em.remove()},t.prototype._click=function(t){t.preventDefault();var i=parseInt(t.currentTarget.getAttribute("data-id"));this._callback(i,this._id)},t}(),a=function(d){function t(){var t=null!==d&&d.apply(this,arguments)||this;return t._favoTags={},t._min=1e7,t._max=0,t._list=[],t._ct=0,t._time=-1,t._isFirstMotion=!0,t._tid=-1,t}return __extends(t,d),t.prototype._callbackFavoTag=function(t,i){switch(t){case 0:f.data.init(i),this._playSound(!1);break;case 1:f.data.init(i),this._playSound(!1),this._clickClose(null);break;case 2:this._favoTags[i]&&(this._favoTags[i].remove(),delete this._favoTags[i]),g.deleteList(i),this._updateFavo()}},t.prototype._updateFavo=function(t){var e=this;void 0===t&&(t=!1);var i=f.data.getHash(),n=g.checkList(i);t&&(n?(this._favoTags[i]&&(this._favoTags[i].remove(),delete this._favoTags[i]),g.deleteList(i)):(g.addList(i),this._favoTags[i]=new w(i,function(t,i){return e._callbackFavoTag(t,i)})),n=!n),n?$("#bt_favo").addClass("active"):$("#bt_favo").removeClass("active")},t.prototype._changeFix=function(t){switch(void 0===t&&(t=-1),t){case 0:f.isFix=!1;break;case 1:f.isFix=!0;break;default:f.isFix=!f.isFix}f.isFix?$("#bt_fix").addClass("active"):$("#bt_fix").removeClass("active")},t.prototype.initialize=function(){var e=this;l.rand=aidn.math.rand,l.randInt=aidn.math.randInt,l.toRad=aidn.math.toRad,l.toDeg=aidn.math.toDeg,f.main=this,f.isMobile=aidn.util.checkMobile(),f.isJa=aidn.util.checkJapanese(),f.isFull=aidn.util.enabledFullscreen(),f.isJa?$(".en").css("display","none"):$(".ja").css("display","none"),f.isMobile?$(".pc").css("display","none"):$(".sp").css("display","none"),g.init(),this._accessUrl=location.href,f.data.init(location.hash)?this._changeFix(1):this._changeFix(0),this._updateFavo();for(var t=g.getList(),i=0;i<t.length;i++){var n=t[i];this._favoTags[n]=new w(n,function(t,i){return e._callbackFavoTag(t,i)})}var o=location.href.split("#")[0].split("?")[0];$("#tw").on("click",function(t){t.preventDefault();aidn.social.shareTw(o,!0,"","daniwell_aidn")}),$("#fb").on("click",function(t){t.preventDefault(),aidn.social.shareFb(o,!0)}),this._scene=new x,this._scene.init(["loading","top","main"],null,150),this._show(v.LOADING),d.prototype.initialize.call(this);var s=new y;s.addEventListener(p.PROGRESS,function(t){return e._initProgress(t)}),s.addEventListener(p.COMPLETE,function(t){return e._initComplete(t)}),s.execute();for(var r=m.SIZE,a="",c=0,h=0;h<r;h++){a+="<tr>";for(var u=0;u<r;u++)a+="<td data-id='"+c+"'><span></span></td>",c++;a+="</tr>"}var _=$(a);this._grids=_.children("td"),this._grids.on("click",function(t){return e._clickGrid(t)}),$("#main table").append(_),this._sound=new l.SoundManager},t.prototype._clickGrid=function(t){if(t.preventDefault(),!f.isFix){var i=parseInt(t.currentTarget.getAttribute("data-id"));f.data.change2base(i)}this._playSound(!1)},t.prototype._updateAllGrids=function(){for(var t=m.SIZE*m.SIZE,i=f.data.getOnOffList(),e=0;e<t;e++)1==i[e]?$(this._grids[e]).removeClass("disable"):$(this._grids[e]).addClass("disable")},t.prototype._initProgress=function(t){t.progress},t.prototype._initComplete=function(t){var i=this;setTimeout(function(){return i._start()},300)},t.prototype._showElem=function(t){$(t).stop().fadeIn(200,"linear")},t.prototype._hideElem=function(t){$(t).stop().fadeOut(200,"linear")},t.prototype._show=function(t){if(f.sceneId!=t){switch(f.sceneId=t){case v.LOADING:case v.TOP:break;case v.MAIN:this._showElem("#ui, #ui2, #ui3")}this._scene.show(t)}},t.prototype._start=function(){var i=this;this._show(v.TOP),$("#top").on("click",function(t){return i._clickStart(t)}),$("#bt_close").on("click",function(t){return i._clickClose(t)}),$("#bt_howto").on("click",function(t){return i._clickHowto(t)}),$("#bt_share").on("click",function(t){return i._clickShare(t)}),$("#bt_save").on("click",function(t){return i._clickSave(t)}),$("#bt_list").on("click",function(t){return i._clickList(t)}),$("#bt_favo").on("click",function(t){return i._clickFavo(t)}),$("#bt_fix").on("click",function(t){return i._clickFix(t)}),$("#bt_tweet").on("click",function(t){return i._clickTweet(t)}),$("#share_url").on("click",function(){try{var t=document.createRange(),i=document.getElementById("share_url");t.selectNodeContents(i);var e=window.getSelection();e.removeAllRanges(),e.addRange(t),document.execCommand("copy"),$("#share_url").stop().css("opacity",0).animate({opacity:1},500,"linear"),$("#copy").stop().show().fadeIn(0).delay(1200).fadeOut(300,"linear")}catch(t){}}),this._barMng=new r,d.prototype._start.call(this)},t.prototype._devicemotionHandler=function(t){var i=t.accelerationIncludingGravity||t.acceleration;this._isFirstMotion&&($(".ios").hide(),this._isFirstMotion=!1);var e=i.x,n=i.y,o=i.z,s=e*e+n*n+o*o;s<this._min&&(this._min=s),this._max<s&&(this._max=s),this._list.push(s),3<this._list.length&&this._list.shift();for(var r=this._list.length,a=0,c=0;c<r;c++)a+=this._list[c];a/=r;var h=1-f.sensitivity;if(100+1500*(h*=h)<a){if(this._time<Date.now()){switch(f.floatingId){case u.SHARE:case u.SAVE:case u.FAVO:return void(this._ct=0)}this._ct++,1<=this._ct&&(this._playSound(!f.isFix),this._time=Date.now()+300,this._ct=0)}}else this._ct=0},t.prototype._play=function(t){t.preventDefault(),this._playSound(!1)},t.prototype._playSound=function(t,i){var e=this;if(void 0===t&&(t=!0),void 0===i&&(i=1),t){var n=c.randIntMax();f.data.id=n,f.data.version=m.VERSION}this._sound.play(f.data,i),this._updateFavo(),this._updateAllGrids(),clearTimeout(this._tid),$("#share_url").text(m.URL+"#"+f.data.getHash()),i<=0||(this._accessUrl==location.href?this._updateHash():(history.back(),this._tid=setTimeout(function(){return e._updateHash()},50)))},t.prototype._updateHash=function(){location.hash=f.data.getHash()},t.prototype._clickStart=function(t){var i=this;t.preventDefault(),this._sound.userAction();var e=location.href.split("#");2<=e.length&&1<=e[1].length?this._playSound(!1):this._playSound(!1,0),"undefined"!=typeof DeviceMotionEvent&&13<=aidn.util.getiOSVersion()&&DeviceMotionEvent.requestPermission(),window.addEventListener("devicemotion",function(t){return i._devicemotionHandler(t)}),$("#view").on(f.isMobile?"touchstart":"mousedown",function(t){return i._play(t)}),this._show(v.MAIN),1==g.first&&(g.first=0,$("#arrow").stop().delay(200).fadeIn(300,"linear").delay(5e3).fadeOut(300,"linear"))},t.prototype._clickClose=function(t){t&&t.preventDefault(),f.floatingId=-1,this._hideElem("#cover, #howto, #share, #save, #list, #bt_close"),aidn.window.scrollOff()},t.prototype._clickHowto=function(t){t.preventDefault(),f.floatingId=u.HOWTO,this._showElem("#cover, #howto, #bt_close"),aidn.window.scrollOn(),$("#arrow").stop().fadeOut(300,"linear")},t.prototype._clickShare=function(t){t.preventDefault(),f.floatingId=u.SHARE,this._showElem("#cover, #share, #bt_close")},t.prototype._clickSave=function(t){t.preventDefault(),f.floatingId=u.SAVE,this._showElem("#cover, #save, #bt_close")},t.prototype._clickList=function(t){t.preventDefault(),f.floatingId=u.FAVO,this._showElem("#cover, #list, #bt_close"),aidn.window.scrollOn()},t.prototype._clickFavo=function(t){t.preventDefault(),this._updateFavo(!0)},t.prototype._clickFix=function(t){t.preventDefault(),this._changeFix()},t.prototype._clickTweet=function(t){t.preventDefault();var i=$("#share_url").text();aidn.social.shareTw(i,!0,"","daniwell_aidn")},t.prototype._update=function(){var t=this;d.prototype._update.call(this),i.delta,i.time,window.requestAnimationFrame(function(){return t._update()})},t.prototype._resize=function(){d.prototype._resize.call(this),i.stw,i.sth},t}(t);(o=u||(u={}))[o.HOWTO=0]="HOWTO",o[o.SHARE=1]="SHARE",o[o.SAVE=2]="SAVE",o[o.FAVO=3]="FAVO",(s=v||(v={}))[s.LOADING=0]="LOADING",s[s.TOP=1]="TOP",s[s.MAIN=2]="MAIN";var x=function(){function t(){this._id=-1,this._scenes=[]}return t.prototype.init=function(t,i,e){void 0===i&&(i=null),void 0===e&&(e=200);for(var n=t.length,o=0;o<n;o++){var s=t[o],r=o;i&&(r=i[o]),this._scenes[r]="string"==typeof s?$("#"+s):s}this._fadeTime=e},t.prototype._showElem=function(t,i){void 0===i&&(i=0),$(t).stop().delay(i).fadeIn(this._fadeTime,"linear")},t.prototype._hideElem=function(t){$(t).stop().fadeOut(this._fadeTime,"linear")},t.prototype.show=function(t){0<=this._id&&this._hideElem(this._scenes[this._id]),0<=t&&this._showElem(this._scenes[t],this._fadeTime),this._id=t},t}(),c=function(){function t(){}return t.init=function(){this._inited||(this._inited=!0,BigNumber.set({ROUNDING_MODE:3}))},t.setSeed=function(t){this.seed="object"!=typeof t?new BigNumber(t):t},t.get2p64=function(){return new BigNumber(2).pow(64)},t._shift=function(t,i){var e=t.toString(2).split(".")[0];if("0"==e)return new BigNumber(e);for(var n=Math.abs(i),o=0;o<n;o++)0<i?e+="0":e=e.slice(0,-1);return""==e&&(e="0"),new BigNumber(e,2)},t._xor=function(t,i){for(var e=t.toString(2).split(".")[0],n=i.toString(2).split(".")[0],o=Math.max(e.length,n.length),s="",r=0;r<o;r++){var a=e.charAt(e.length-r-1),c=n.charAt(n.length-r-1);s=a==c?"0"+s:"1"==a||"1"==c?"1"+s:"0"+s}return new BigNumber(s,2)},t.random=function(t){void 0===t&&(t=null),this.init();var i=this.seed;return null!=t&&(i=isNaN(t)?t:new BigNumber(t)),i=this._xor(i,this._shift(i,13)),i=this._xor(i,this._shift(i,-17)),i=this._xor(i,this._shift(i,15)),this.seed=i=i.mod(new BigNumber("18446744073709551616")),i.div(new BigNumber("18446744073709551616"))},t.randInt=function(t,i,e){return void 0===e&&(e=null),"object"!=typeof t&&(t=new BigNumber(t)),"object"!=typeof i&&(i=new BigNumber(i)),this.rand(t,i.plus(1),e).integerValue()},t.rand=function(t,i,e){return void 0===e&&(e=null),"object"!=typeof t&&(t=new BigNumber(t)),"object"!=typeof i&&(i=new BigNumber(i)),this.random(e).times(i.minus(t)).plus(t)},t.randIntMax=function(t){return void 0===t&&(t=64),new BigNumber(2).pow(t).times(Math.random()).integerValue()},t.randomN=function(t){return void 0===t&&(t=null),this.random(t).toNumber()},t.randNInt=function(t,i,e){return void 0===e&&(e=null),this.randInt(new BigNumber(t),new BigNumber(i),e).toNumber()},t.randN=function(t,i,e){return void 0===e&&(e=null),this.rand(new BigNumber(t),new BigNumber(i),e).toNumber()},t.seed=new BigNumber(0),t._inited=!1,t}();l.UtilBig=c,$(function(){return(new a).initialize()})}(app||(app={}));