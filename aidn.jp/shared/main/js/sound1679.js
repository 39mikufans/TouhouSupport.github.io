var sound;!function(){(sound||(sound={})).check=function(){$(function(){(new t).initialize()})};var t=(e.prototype.initialize=function(){var e=this;this._audio=new aidn.Audio,this._audio.addEndEvent(function(){return e._playerStop()});var t="../shared/main/data/sound.json",a=$("body").attr("data-ver");a&&(t+="?"+a),$.ajax({url:t,dataType:"json"}).then(function(t){return e._loadComplete(t)})},e.prototype._loadComplete=function(t){var e=this,a=t.aidn.list,s=a.concat(),i=a.concat();s.sort(function(t,e){var a=0;t.date||(t.date="2000-01-01"),e.date||(e.date="2000-01-01");t=new Date(t.date).getTime(),e=new Date(e.date).getTime();return t<e?a=1:e<t&&(a=-1),a}),i.sort(function(t,e){var a=0;return t.pt<e.pt?a=1:e.pt<t.pt&&(a=-1),a});for(var r=[a,s,i],n="",o=0;o<r.length;o++)n+='<div id="sound'+o+'">',n+=this._getTagStr(o,r[o],t),n+="</div>";$("#sound").html(n),$(".bt_play").on("click",function(t){return e._clickPlay(t)}),$(".bar").on("click",function(t){return e._clickBar(t)}),$(".bt_lyrics").on("click",function(t){return e._clickLyrics(t)}),$(".niconico,.youtube,.twitter,.mp4,.web").on("click",function(){return e._playerStop()}),$("#bt_close").on("click",function(t){$("#lyrics_base").stop().fadeOut(200)}),$("#loading").hide();for(var l=$("#sound0 .sound").length,o=0;o<r.length;o++){this.__emSounds[o]=[];for(var h=0;h<l;h++)this.__emSounds[o][h]=$($("#sound"+o+" .sound").get(h))}i=aidn.util.getQuery(),i=parseInt(i.sort);0<=i&&i<r.length?this._sortSounds(i):this._sortSounds(2),$("#sortby").on("change",function(t){return e._changeSortby(t)}),$("#search, p.select_con").show(),this._emInput=$("#in_search"),this._emInput.on("change",function(t){return e._changeText(t)}),setInterval(function(){return e._checkSearcText()},200);i=decodeURIComponent(location.hash.split("#").join(""));i&&1<=i.length&&(history.replaceState||(location.hash=""),this._emInput.val(i),this._checkSearcText())},e.prototype._changeSortby=function(t){var e=parseInt($("#sortby").val());this._sortSounds(e)},e.prototype._sortSounds=function(t){$("#sortby").val(t),this._playerStop();for(var e=0;e<this.__titles.length;e++)e==t?$("#sound"+e).stop().fadeIn(300,"linear"):$("#sound"+e).hide();var a=2!=t?"?sort="+t:"";a+=location.hash,aidn.util.changeUrl(a,!1)},e.prototype._getTagStr=function(t,e,a){var s=a.aidn.base,i=a.aidn.baseLyrics,r=e.length,n="";this.__titles[t]=[];for(var o=0;o<r;o++){var l=e[o],h=l.title,c="";l.vocal?c+="VOCAL: "+l.vocal+" / ":l.voice&&(c+="VOICE: "+l.voice+" / "),c+="BPM: "+l.bpm,l.date&&l.date.indexOf("2000")<0&&(c+=" / DATE: "+l.date.split("-").join("."));var p,u,_=s+l.mp3,d=s+l.mp3Off,v=l.twitter,g=l.niconico,f=l.youtube,y=i+l.lyrics,m=l.time;l.mp3&&(p=(w=_.split("/"))[w.length-1]),l.mp3Off&&(u=(w=d.split("/"))[w.length-1]);var b=d;l.mp3&&(b=_);var w,k=h.toLowerCase()+" ";(w=k.match(/[\u30a1-\u30f6]/g))&&(k+=k.replace(/[\u30a1-\u30f6]/g,function(t){t=t.charCodeAt(0)-96;return String.fromCharCode(t)})+" "),l.search&&(k+=l.search.toLowerCase()),this.__titles[t][o]=k,n+='<div class="sound">',1==l.break?n+='<p class="title break">'+h+"</p>":n+='<p class="title">'+h+"</p>",n+='<p class="text">'+c+"</p>",n+='<div class="ui">',n+='<a href="" class="bt_play" data-path="'+b+'" data-time="'+m+'"><svg viewBox="0 0 24 24"><use xlink:href="#svg_play"></use></svg><svg viewBox="0 0 24 24"><use xlink:href="#svg_stop"></use></svg></a>',n+='<span class="bar"><span class="prog"></span></span>',n+="</div>",n+='<p class="btns">',l.buy&&(n+='<a href="../daniwell/#x_'+l.buy+'"><svg viewBox="0 0 24 24"><use xlink:href="#svg_buy"></use></svg>BUY</a>'),l.mp3&&(n+='<a href="'+_+'" download="'+p+'"><svg viewBox="0 0 24 24"><use xlink:href="#svg_music"></use></svg>MP3</a>'),l.mp3Off&&(n+='<a href="'+d+'" download="'+u+'"><svg viewBox="0 0 24 24"><use xlink:href="#svg_music"></use></svg>MP3 (inst)</a>'),l.mp4&&(n+='<a href="'+(0<=l.mp4.indexOf("http")?l.mp4:"https://drive.google.com/uc?id="+l.mp4+"&export=download")+'"><svg viewBox="0 0 24 24"><use xlink:href="#svg_movie"></use></svg>MP4</a>'),l.web&&(n+='<a href="'+l.web+'" target="_blank" class="web"><svg viewBox="0 0 24 24"><use xlink:href="#svg_web"></use></svg>WEB</a>'),v&&(n+='<a href="'+v+'" target="_blank" class="twitter"><svg viewBox="0 0 24 24"><use xlink:href="#svg_tw"></use></svg>TWITTER</a>'),f&&(n+='<a href="'+f+'" target="_blank" class="youtube"><svg viewBox="0 0 24 24"><use xlink:href="#svg_youtube"></use></svg>YOU TUBE</a>'),g&&(n+='<a href="'+g+'" target="_blank" class="niconico"><svg viewBox="0 0 24 24"><use xlink:href="#svg_niconico"></use></svg>NICONICO</a>'),l.lyrics&&(n+='<a href="" class="bt_lyrics" data-title="'+h+'"'+(1==l.break?' data-break="1"':"")+' data-path="'+y+'"><svg viewBox="0 0 24 24"><use xlink:href="#svg_lyrics"></use></svg>LYRICS</a>'),n+="</p>",n+="</div>"}return n},e.prototype._changeText=function(t){""==this._emInput.val().replace(/[ 　\t]*/g,"")&&this._emInput.val(""),this._checkSearcText()},e.prototype._checkSearcText=function(){var t=e=this._emInput.val(),e=e.toLowerCase();if(this._val!=e){this._val=e,this._search(e);try{var a="/"+location.href.split("#")[0].split("//")[1].split("/").splice(1).join("/");0<t.length&&(a+="#"+t),history.replaceState(null,null,a)}catch(t){}}},e.prototype._search=function(t){for(var e=this.__titles[0].length,a=""==t,s=0;s<this.__titles.length;s++)for(var i=0;i<e;i++){var r=this.__titles[s][i],n=this.__emSounds[s][i];a||0<=r.indexOf(t)?n.show():n.hide()}},e.prototype._update=function(){var t,e=this;this._nowPath&&""!=this._nowPath&&(this._audio&&(t=this._audio.time/this._audio.duration*100,this._tmpProg.css({width:t+"%"})),window.requestAnimationFrame(function(){return e._update()}))},e.prototype._clickBar=function(t){var e=$(t.currentTarget).parent().children(".bt_play"),a=e.attr("data-path"),s=t.offsetX/$(t.currentTarget).width();if(0<=s&&s<1||(s=0),this._nowPath==a){var i=this._audio.duration*s;try{this._audio.time=i}catch(t){}}else{i=parseInt(e.attr("data-time"))/1e3;this.__play(e,i*s)}},e.prototype._clickPlay=function(t){t.preventDefault(),this.__play($(t.currentTarget))},e.prototype.__play=function(t,e){var a=this;void 0===e&&(e=0);var s=t.attr("data-path");this._nowPath!=s?(this._playerStop(),this._nowPath=s,this._tmpElem=t,this._tmpTitle=t.parent().parent().children(".title"),this._tmpProg=t.parent().find(".prog"),this._tmpProg.css({width:0}),this._audio.load([s]),this._audio.play(e,!1,function(){return a._playerPlay()}),this._tmpElem.addClass("loading")):this._playerStop()},e.prototype._clickLyrics=function(t){var e=this;t.preventDefault();var a=$(t.currentTarget).attr("data-path"),s=$(t.currentTarget).attr("data-title"),t=$(t.currentTarget).attr("data-break");this.__title=s,this.__wbreak=parseInt(t),$("#lyrics_area").html('<h2 class="loading">-</h2>'),$("#lyrics_base").stop().fadeIn(300),$.ajax({url:a,dataType:"text"}).then(function(t){return e._lyricsComplete(t)},function(){return e._lyricsError()})},e.prototype._lyricsComplete=function(t){for(var e="",a=t.split("\n"),s=a.length,i=0;i<s;i++){var r=a[i],n=r.match(/｛.+?｝/g);if(n)for(var o=0;o<n.length;o++){var l=n[o],h=l.substr(1,l.length-2).split("／");2<=h.length&&(r=r.replace(l,"<ruby><rb>"+h[0]+"</rb><rp>＜</rp><rt>"+h[1]+"</rt><rp>＞</rp></ruby>"))}e+=r+"<br>"}t=1==this.__wbreak?'<h2 class="break">':"<h2>";$("#lyrics_area").html(t+this.__title+"</h2><p>"+e+"</p>"),$("#lyrics_area").scrollTop(0)},e.prototype._lyricsError=function(){$("#lyrics_base").stop().fadeOut(200)},e.prototype._playerPlay=function(){this._tmpElem&&(this._tmpElem.removeClass("loading"),this._tmpElem.addClass("btn_playing"),this._tmpTitle.addClass("playing"),this._update())},e.prototype._playerStop=function(){this._tmpElem&&(this._tmpElem.removeClass("loading"),this._tmpElem.removeClass("btn_playing"),this._tmpElem=null,this._tmpTitle.removeClass("playing"),this._tmpTitle=null,this._tmpProg.css({width:0})),this._audio.pause(),this._nowPath=""},e);function e(){this.__titles=[],this.__emSounds=[],this._val=""}}(),sound.check();